import{u as o,r as f,j as t,c as y,R as j,S as _}from"./styles.js";function B(r){return new Intl.NumberFormat("en-US").format(r)}function D(r,i){return Math.floor((i.getTime()-r.getTime())/864e5)}function U(r){if(!r)return"";const i=new Date(r),c=D(i,new Date);return c<183?"recruit":c<730?"experienced":"veteran"}function H(r){return r==="recruit"?"Recruit":r==="experienced"?"Experienced":r==="veteran"?"Veteran":""}function q(r){return r==="twitch"?"Twitch":"Other"}function C(){const r=o(i=>i.directoryMeta);return t.jsx(t.Fragment,{children:r})}function I(){const r=o(s=>s.directoryList),i=f.useMemo(()=>r||[],[r]);return t.jsx(t.Fragment,{children:i.map(s=>{const c=s.isLive!==!1,n=H(U(s.createdAt||null)),d=c?`${B(s.viewerCount||0)} viewers`:"Currently offline";return t.jsxs("article",{className:"stream-card","data-id":s.id,children:[t.jsx("div",{className:"stream-card__avatar","aria-hidden":"true",children:s.profileImageUrl?t.jsx("img",{className:"stream-card__avatar-img",src:s.profileImageUrl,alt:s.title,loading:"lazy"}):null}),t.jsxs("div",{children:[t.jsx("h3",{className:"stream-card__title",children:s.title}),t.jsxs("div",{className:"stream-card__sub",children:[t.jsx("span",{children:q(s.platform)}),t.jsx("span",{children:s.category||""}),t.jsx("span",{children:s.language?s.language.toUpperCase():""}),t.jsx("span",{children:d}),t.jsx("span",{children:n})]})]}),t.jsxs("div",{className:"stream-card__actions",children:[t.jsx("button",{className:"action-btn action-btn--primary js-watch-slot-btn",type:"button","data-id":s.id,disabled:!c,children:"Watch"}),t.jsx("button",{className:"action-btn js-add-btn",type:"button","data-id":s.id,disabled:!c,children:"Add"})]})]},s.id)})})}function O(){const r=o(e=>e.hydrateLiveStreams),i=o(e=>e.seedFromUrl),s=o(e=>e.streams),c=o(e=>e.slots),n=o(e=>e.targetSlot),d=o(e=>e.activeSlot),M=o(e=>e.focusMode),v=o(e=>e.setTargetSlot),S=o(e=>e.setActiveSlot),h=o(e=>e.setFocusMode),x=o(e=>e.toggleFocusMode);return f.useEffect(()=>{i(window.location.search),s.length||r()},[r,i,s.length]),f.useEffect(()=>{window.dispatchEvent(new CustomEvent("multiview:state-change",{detail:{slots:c,targetSlot:n,activeSlot:d,focusMode:M}}))},[c,n,d,M]),f.useEffect(()=>{var N;const e=document.querySelector(".js-focus-toggle"),w=Array.from(document.querySelectorAll(".js-slot-btn")),E=((N=w[0])==null?void 0:N.closest(".slot-toggle"))||null,L=document.querySelector(".js-page"),b=()=>x();e==null||e.addEventListener("click",b);const T=[];w.forEach(a=>{const l=()=>{const u=Number(a.dataset.slot||"1");v(u),S(u)};a.addEventListener("click",l),T.push({btn:a,fn:l})});const F=a=>{if(a.key==="Escape"&&o.getState().focusMode){h(!1);return}if(a.key==="1"||a.key==="2"||a.key==="3"||a.key==="4"){const l=Number(a.key);v(l),S(l)}};document.addEventListener("keydown",F);const g=()=>{const a=o.getState(),l=Object.values(a.slots).filter(Boolean).length,u=Math.max(0,...[1,2,3,4].filter(m=>!!a.slots[m])),p=window.location.pathname==="/multiview"||window.location.pathname==="/multiview/";l<2&&a.focusMode&&h(!1),e instanceof HTMLElement&&(e.hidden=!p||l<2,e.classList.toggle("is-active",!!a.focusMode),e.setAttribute("aria-pressed",a.focusMode?"true":"false")),E instanceof HTMLElement&&(E.hidden=!p||u<2),w.forEach(m=>{const k=Number(m.dataset.slot||"0");m instanceof HTMLElement&&(m.hidden=!p||u<2||k>u,m.classList.toggle("is-active",k===a.targetSlot))}),L instanceof HTMLElement&&L.classList.toggle("is-focus-mode",!!a.focusMode)};g();const A=o.subscribe(g);return window.addEventListener("popstate",g),()=>{e==null||e.removeEventListener("click",b),T.forEach(({btn:a,fn:l})=>a.removeEventListener("click",l)),document.removeEventListener("keydown",F),window.removeEventListener("popstate",g),A()}},[S,h,v,x]),t.jsx("div",{className:"multiview-embedded",children:t.jsx(_,{})})}const R=document.getElementById("react-multiview-root");if(R){y.createRoot(R).render(t.jsx(j.StrictMode,{children:t.jsx(O,{})}));const i={setStreams:o.getState().setStreams,setDirectoryList:(n,d)=>o.getState().setDirectoryList(n,d),assignStream:n=>o.getState().assignStreamToTarget(n),assignStreamToSlot:(n,d)=>o.getState().assignStreamToSlot(n,d),clearSlot:n=>o.getState().clearSlot(n),setTargetSlot:n=>o.getState().setTargetSlot(n),setActiveSlot:n=>o.getState().setActiveSlot(n),setFocusMode:n=>o.getState().setFocusMode(n),toggleFocusMode:()=>o.getState().toggleFocusMode()};window.multiviewBridge=i;const s=document.querySelector(".js-stream-list");s&&y.createRoot(s).render(t.jsx(j.StrictMode,{children:t.jsx(I,{})}));const c=document.querySelector(".js-results-meta");c&&y.createRoot(c).render(t.jsx(j.StrictMode,{children:t.jsx(C,{})}))}
